# yStandard v5機能改修

## 「投稿ページ」「固定ページ」設定の刷新

### 現在の実装状況
- 現在は `inc/post/class-post-customizer.php` で投稿・固定ページの設定を実装
- 「デザイン」パネル内の「投稿ページ」「固定ページ」セクションで設定を管理
- 投稿・固定ページごとに固定された設定項目を持つ

### 刷新内容
- 投稿・固定ページ以外の投稿タイプもサポートする
- 投稿タイプの設定で階層あり（固定ページ）かそれ以外かで設定項目を判定
- 投稿タイプはWordPress標準で追加される投稿タイプ以外かつ、ページが作成可能な投稿タイプのみとする
- 設定は inc/post-types フォルダ内にクラスを作成して実装する
- 「デザイン」パネル内の「投稿ページ」「固定ページ」設定は削除

### 実装方針

#### 1. 投稿タイプ検出ロジック
- `inc/utils/class-post-type.php` の既存機能を活用
- `get_post_types(['public' => true])` でパブリック投稿タイプを取得
- 除外対象：`attachment`、WordPress標準投稿タイプ（post, page）以外で必要に応じて
- 階層判定：`is_post_type_hierarchical()` を使用
- フォールバック：`get_fallback_post_type()` で post または page の設定を流用

#### 2. ディレクトリ構造
```
inc/post-types/
├── index.php
├── class-post-types-manager.php      // 投稿タイプ設定の管理クラス
├── class-post-type-customizer.php    // カスタマイザー設定基底クラス
├── class-hierarchical-post-type.php  // 階層ありタイプ（page like）
└── class-non-hierarchical-post-type.php // 階層なしタイプ（post like）
```

#### 3. 設定項目の分類
**階層なし投稿タイプ（post like）の設定項目:**
- レイアウト（1col/2col）
- アイキャッチ画像表示タイプ（default/full）
- 本文エリア背景色設定
- 記事上部：アイキャッチ表示、投稿日・更新日、カテゴリー表示
- 記事下部：カテゴリー・タグ、著者情報、関連記事、次前記事

**階層あり投稿タイプ（page like）の設定項目:**
- レイアウト（1col/2col）
- アイキャッチ画像表示タイプ（default/full）
- 本文エリア背景色設定
- 記事上部：アイキャッチ表示、投稿日・更新日
- 記事下部：著者情報

#### 4. カスタマイザー設定の配置
- 各投稿タイプごとに独立したセクションを作成
- セクション名：「[投稿タイプ名]ページ」（例：「商品ページ」「イベントページ」）
- 優先度：カスタマイザートップレベルに配置（デザインパネル外）
- 優先度順序：標準投稿タイプ（post, page）→ カスタム投稿タイプ（アルファベット順）

#### 5. 既存設定の移行
- `inc/post/class-post-customizer.php` を廃止
- 既存の投稿・固定ページ設定は新システムに移行
- オプション名は互換性を保つため変更しない
- 設定値は既存のものをそのまま利用

#### 6. 動的設定読み込み
- WordPress init アクション後に投稿タイプを検出
- 検出された投稿タイプに応じて動的にカスタマイザー設定を生成
- キャッシュ機能は不要（投稿タイプは比較的固定的）

## カスタマイザー「デザイン」設定の分割

- 「デザイン」設定の廃止・分割

### 「全体デザイン」の新設

- 「全体デザイン」はパネルとする
- 既存設定の「フォント・文字色」「リンクカラー」「サイト背景」を含む

### 「メニュー・ナビゲーション」の新設

- 「メニュー・ナビゲーション」はパネルとする
- 「グローバルナビゲーション」「ドロワーメニュー」を含む

### 「デザイン」パネルから離し、それぞれ独立した設定にする

- 現在設定パネル内にある以下のメニューを「デザイン」パネル外に出す（カスタマイザーを開いた際に表示されるメニューとする）
- 対象メニュー：「サイトヘッダー」「モバイル表示」「目次」「アーカイブページ」「フッター」「Copyright」
- 表示順の調整を忘れずに行う

## カスタマイザー「ブロックエディター > カラーパレット」設定の刷新

- 既存カラーパレットを上書きするのではなく、新しく色設定を追加できるようにする。
- 追加できる件数の上限は無し。

## ys_get_template_partの廃止

- 処理実態としては\ystandard\Template::get_template_part
- WPコアのget_template_partを利用する
- slugにファイルパスが指定された場合に該当ファイルをincludeする処理が実現できるか確認が必要

## template-parts/parts 内の整理

@template-parts/parts ディレクトリ内の各ファイルを @template-parts にカテゴリーごとにディレクトリを分けて配置し、参照している部分も合わせて更新する
